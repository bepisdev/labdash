<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>
  <link rel="stylesheet" href="/css/styles.css">
</head>
<body<% if config['background_image'] && !config['background_image'].empty? %> style="background-image: url('<%= config['background_image'] %>');"<% end %>>
  <div class="container">
    <header>
      <h1><%= title %></h1>
      <% if config['subtitle'] %>
        <p class="subtitle"><%= config['subtitle'] %></p>
      <% end %>
    </header>
    
    <div class="toolbar">
      <div class="filter-group">
        <label for="tag-filter" class="filter-label">Filter by tag:</label>
        <select id="tag-filter" class="tag-filter-dropdown">
          <option value="">All Services</option>
          <% 
            # Collect all unique tags from all services
            all_tags = categories.flat_map { |cat| (cat['services'] || []).flat_map { |s| s['tags'] || [] } }.uniq.sort
          %>
          <% all_tags.each do |tag| %>
            <option value="<%= tag %>"><%= tag %></option>
          <% end %>
        </select>
      </div>
    </div>
    
    <main>
      <% if categories.empty? %>
        <!-- No categories configured -->
        <section class="services-grid">
          <p class="category-description">No categories configured.</p>
        </section>
      <% else %>
        <!-- Show services organized by categories -->
        <% categories.each do |category| %>
          <% category_services = category['services'] || [] %>
          <% unless category_services.empty? %>
            <section class="category-section">
              <h2 class="category-title"><%= category['name'] %></h2>
              <% if category['description'] %>
                <p class="category-description"><%= category['description'] %></p>
              <% end %>
              <div class="services-grid">
                <% category_services.each do |service| %>
                  <%= erb :service_card, locals: { service: service } %>
                <% end %>
              </div>
            </section>
          <% end %>
        <% end %>
      <% end %>
    </main>
    
    <footer>
      <p>LabDash - Homelab Dashboard. Open source on <a href="https://github.com/bepisdev/labdash">Github</a></p>
    </footer>
  </div>
  
  <script src="/js/app.js"></script>
</body>
</html>
